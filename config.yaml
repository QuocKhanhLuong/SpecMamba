# =============================================================================
# EGM-Net Configuration File
# =============================================================================

preset: "bio"

# =============================================================================
# MODEL CONFIGURATION
# =============================================================================
model:
  name: "EGMNet"
  in_channels: 3
  num_classes: 4
  img_size: 224
  
  backbone:
    type: "hrnet"  # "hrnet" or "simple"
    base_channels: 32
    num_stages: 4
    blocks_per_stage: 2
    
  # =============================================================================
  # BLOCK OPTIONS (thay tháº¿ Mamba)
  # =============================================================================
  # Available blocks:
  #   - "convnext"          : ConvNeXt Block (SOTA CNN, 7x7 depthwise)
  #   - "dcn"               : Deformable Conv v2 (learnable kernel offsets)
  #   - "inverted_residual" : MobileNetV2 style (lightweight)
  #   - "swin"              : Swin Transformer (window attention)
  #   - "fno"               : Fourier Neural Operator (spectral conv)
  #   - "wavelet"           : Wavelet Transform Block (multi-scale)
  #   - "rwkv"              : RWKV Block (linear attention)
  #   - "mamba"             : Mamba SSM (requires mamba-ssm package)
  #   - "none"              : No additional blocks (pure HRNet)
  # =============================================================================
  block:
    type: "convnext"  # Default to ConvNeXt (stable, SOTA)
    depth: 2          # Number of blocks per stage
    
    # Block-specific settings
    convnext:
      drop_path: 0.1
      layer_scale_init: 1e-6
      
    swin:
      num_heads: 8
      window_size: 7
      mlp_ratio: 4.0
      
    fno:
      modes: 16
      mlp_ratio: 2.0
      
    rwkv:
      # No special params needed
      
    mamba:
      d_state: 16
      d_conv: 4
      expand: 2
    
  components:
    # Mamba SSM (legacy, requires mamba-ssm package)
    use_mamba: false
    mamba_depth: 2
    
    # Spectral FFT processing
    use_spectral: false
    spectral_threshold: 0.1

# =============================================================================
# RETINAL PREPROCESSING (DoG Layer)
# =============================================================================
retinal:
  enabled: true
  type: "dog"  # "dog" (Difference of Gaussians)
  scales: [[1.0, 2.0], [2.0, 4.0]]
  kernel_size: 15
  concat_original: true

# =============================================================================
# SEGMENTATION HEADS
# =============================================================================
heads:
  # Coarse Head (main segmentation)
  coarse:
    type: "constellation"  # "constellation" (RBF), "linear", "conv"
    enabled: true
    embedding_dim: 2
    init_gamma: 1.0
    
  # Fine Head (implicit refinement)
  fine:
    type: "shearlet"  # "gabor", "shearlet", "none"
    enabled: true
    hidden_dim: 256
    num_layers: 4
    num_frequencies: 64
    use_energy_gating: true
    
  # Shearlet-specific config
  shearlet:
    num_orientations: 8
    num_frequencies: 4
    hidden_dim: 256
    
  # Fusion method
  fusion:
    type: "energy_gated"  # "energy_gated", "average", "learned"
    temperature: 1.0

# =============================================================================
# TRAINING CONFIGURATION
# =============================================================================
training:
  epochs: 200
  batch_size: 8
  learning_rate: 1e-4
  weight_decay: 1e-5
  optimizer: "adamw"
  scheduler: "cosine"  # "cosine", "reduce_plateau"
  early_stop: 30
  
  # Gradient clipping
  grad_clip: 1.0
  
  # SOTA Strategies
  sota:
    boundary_loss: true
    boundary_weight: 0.5
    warmup_epochs: 10
    deep_supervision: true
    tta_eval: false
    tta_test: true
  
  # Augmentation
  augmentation:
    random_flip: true
    random_rotation: true
    rotation_range: 15

# =============================================================================
# LOSS CONFIGURATION
# =============================================================================
loss:
  ce_weight: 1.0
  dice_weight: 1.0
  focal_weight: 0.0
  focal_gamma: 2.0
  boundary_weight: 0.5

# =============================================================================
# DATA CONFIGURATION
# =============================================================================
data:
  root: "preprocessed_data/ACDC"
  train_split: 0.8
  num_workers: 0
  pin_memory: true

# =============================================================================
# PRESETS REFERENCE
# =============================================================================
# baseline:
#   - block.type: "none"
#   - retinal.enabled: false
#   - heads.coarse.type: "linear"
#   - heads.fine.enabled: false
#
# lite:
#   - block.type: "inverted_residual"
#   - retinal.enabled: false
#   - heads.coarse.type: "constellation"
#   - heads.fine.enabled: false
#
# sota:
#   - block.type: "convnext"
#   - retinal.enabled: false
#   - heads.coarse.type: "constellation"
#   - heads.fine.type: "gabor"
#
# bio:
#   - block.type: "convnext"
#   - retinal.enabled: true (DoG)
#   - heads.coarse.type: "constellation"
#   - heads.fine.type: "shearlet"
#
# spectral:
#   - block.type: "fno"
#   - retinal.enabled: true
#   - heads.fine.type: "shearlet"
#
# attention:
#   - block.type: "swin"
#   - retinal.enabled: true
#   - heads.fine.type: "gabor"
# =============================================================================
